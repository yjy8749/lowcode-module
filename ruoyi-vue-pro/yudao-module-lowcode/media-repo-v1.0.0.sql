DROP TABLE IF EXISTS `lowcode_media_dir`;
CREATE TABLE `lowcode_media_dir`
(
    `id`          bigint       NOT NULL AUTO_INCREMENT COMMENT '主键',
    `creator`     varchar(64)  NOT NULL DEFAULT '' COMMENT '创建者',
    `create_time` datetime     NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater`     varchar(64)  NOT NULL DEFAULT '' COMMENT '更新者',
    `update_time` datetime     NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted`     bit(1)       NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id`   bigint       NOT NULL DEFAULT 0 COMMENT '租户编号',
    `name`        varchar(255) NOT NULL DEFAULT '' COMMENT '目录名称',
    `id_path`     varchar(255) NOT NULL DEFAULT '' COMMENT '目录id路径',
    `parent_id`   bigint       NOT NULL DEFAULT 0 COMMENT '父id',
    PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB
  AUTO_INCREMENT = 1
  CHARACTER SET = utf8mb4
  COLLATE = utf8mb4_unicode_ci COMMENT = '低代码-媒体库目录';

CREATE INDEX idx_tenant_id ON lowcode_media_dir (tenant_id);
CREATE INDEX idx_name ON lowcode_media_dir (name);
CREATE INDEX idx_id_path ON lowcode_media_dir (id_path);
CREATE INDEX idx_parent_id ON lowcode_media_dir (parent_id);

DROP TABLE IF EXISTS `lowcode_media_file`;
CREATE TABLE `lowcode_media_file`
(
    `id`          bigint       NOT NULL AUTO_INCREMENT COMMENT '主键',
    `creator`     varchar(64)  NOT NULL DEFAULT '' COMMENT '创建者',
    `create_time` datetime     NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater`     varchar(64)  NOT NULL DEFAULT '' COMMENT '更新者',
    `update_time` datetime     NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted`     bit(1)       NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id`   bigint       NOT NULL DEFAULT 0 COMMENT '租户编号',
    `dir_id`      bigint       NOT NULL DEFAULT 0 COMMENT '目录id',
    `dir_id_path` varchar(255) NOT NULL DEFAULT '' COMMENT '目录id路径',
    `type`        varchar(255) NOT NULL DEFAULT '' COMMENT '文件类型',
    `url`         varchar(255) NOT NULL DEFAULT '' COMMENT '文件Url',
    PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB
  AUTO_INCREMENT = 1
  CHARACTER SET = utf8mb4
  COLLATE = utf8mb4_unicode_ci COMMENT = '低代码-媒体库文件';

CREATE INDEX idx_tenant_id ON lowcode_media_file (tenant_id);
CREATE INDEX idx_dir_id ON lowcode_media_file (dir_id);
CREATE INDEX idx_dir_id_path ON lowcode_media_file (dir_id_path);
CREATE INDEX idx_create_time ON lowcode_media_file (create_time);

INSERT INTO lowcode_material_file (id, creator, create_time, updater, update_time, deleted, tenant_id, name, description, source, parent_id, is_file, is_private, status, sort, source_file_id, source_file_version) VALUES (1, '1', '2025-10-01 00:00:00', '1', '2025-10-01 00:00:00', false, 1, '媒体库', '', 1, 0, false, true, 1, 0, 0, 0);
INSERT INTO lowcode_material_file (id, creator, create_time, updater, update_time, deleted, tenant_id, name, description, source, parent_id, is_file, is_private, status, sort, source_file_id, source_file_version) VALUES (2, '1', '2025-10-01 00:00:00', '1', '2025-10-01 00:00:00', false, 1, '媒体库目录-查询', '', 1, 1, true, true, 1, 0, 0, 0);
INSERT INTO lowcode_material_file (id, creator, create_time, updater, update_time, deleted, tenant_id, name, description, source, parent_id, is_file, is_private, status, sort, source_file_id, source_file_version) VALUES (3, '1', '2025-10-01 00:00:00', '1', '2025-10-01 00:00:00', false, 1, '媒体库文件-查询', '', 1, 1, true, true, 1, 0, 0, 0);
INSERT INTO lowcode_material_file (id, creator, create_time, updater, update_time, deleted, tenant_id, name, description, source, parent_id, is_file, is_private, status, sort, source_file_id, source_file_version) VALUES (4, '1', '2025-10-01 00:00:00', '1', '2025-10-01 00:00:00', false, 1, '媒体库', '', 2, 0, false, true, 1, 0, 0, 0);
INSERT INTO lowcode_material_file (id, creator, create_time, updater, update_time, deleted, tenant_id, name, description, source, parent_id, is_file, is_private, status, sort, source_file_id, source_file_version) VALUES (5, '1', '2025-10-01 00:00:00', '1', '2025-10-01 00:00:00', false, 1, '媒体库目录-表单', '', 2, 4, true, true, 1, 0, 0, 0);
INSERT INTO lowcode_material_file (id, creator, create_time, updater, update_time, deleted, tenant_id, name, description, source, parent_id, is_file, is_private, status, sort, source_file_id, source_file_version) VALUES (6, '1', '2025-10-01 00:00:00', '1', '2025-10-01 00:00:00', false, 1, '媒体库文件-列表', '', 2, 4, true, true, 1, 0, 0, 0);
INSERT INTO lowcode_material_file (id, creator, create_time, updater, update_time, deleted, tenant_id, name, description, source, parent_id, is_file, is_private, status, sort, source_file_id, source_file_version) VALUES (7, '1', '2025-10-01 00:00:00', '1', '2025-10-01 00:00:00', false, 1, '媒体库文件-选择', '', 2, 4, true, true, 1, 0, 0, 0);

INSERT INTO lowcode_material_file_data (id, creator, create_time, updater, update_time, deleted, tenant_id, file_id, file_source, data_type, version, data) VALUES (1, '1', '2025-10-01 00:00:00', '1', '2025-10-01 00:00:00', false, 1, 2, 1, 0, 1, '{"apiName": "lowcode-media-dir", "channels": [0], "queryXml": "<?xml version=\\"1.0\\" encoding=\\"UTF-8\\"?>\\n<QueryDomain desc=\\"低代码-媒体库目录\\" login=\\"true\\">\\n  <MainTable id=\\"lowcodeMediaDir\\" table=\\"lowcode_media_dir\\">\\n    <QueryField comment=\\"主键\\" hidden=\\"false\\" id=\\"id\\" name=\\"id\\" symbols=\\"EQ\\"/>\\n    <QueryField comment=\\"目录名称\\" id=\\"name\\" name=\\"name\\"/>\\n    <QueryField comment=\\"父id\\" id=\\"parent_id\\" name=\\"parentId\\" symbols=\\"EQ\\"/>\\n  </MainTable>\\n</QueryDomain>\\n", "queryTypes": ["selectList", "selectOne", "selectPage"], "dataSourceId": 0}');
INSERT INTO lowcode_material_file_data (id, creator, create_time, updater, update_time, deleted, tenant_id, file_id, file_source, data_type, version, data) VALUES (2, '1', '2025-10-01 00:00:00', '1', '2025-10-01 00:00:00', false, 1, 3, 1, 0, 1, '{"apiName": "lowcode-media-file", "channels": [0], "queryXml": "<?xml version=\\"1.0\\" encoding=\\"UTF-8\\"?>\\n<QueryDomain desc=\\"低代码-媒体库文件\\" login=\\"true\\">\\n  <MainTable id=\\"lowcodeMediaFile\\" table=\\"lowcode_media_file\\">\\n    <QueryField comment=\\"主键\\" id=\\"id\\" name=\\"id\\"/>\\n    <QueryField comment=\\"创建时间\\" id=\\"create_time\\" name=\\"createTime\\"/>\\n    <QueryField comment=\\"目录id\\" id=\\"dir_id\\" name=\\"dirId\\" symbols=\\"EQ\\"/>\\n    <QueryField comment=\\"目录id路径\\" id=\\"dir_id_path\\" name=\\"dirIdPath\\"/>\\n    <QueryField comment=\\"文件类型\\" id=\\"type\\" name=\\"type\\"/>\\n    <QueryField comment=\\"文件Url\\" id=\\"url\\" name=\\"url\\" symbols=\\"EQ\\"/>\\n  </MainTable>\\n</QueryDomain>\\n", "queryTypes": ["selectPage"], "dataSourceId": 0, "dataSourceTableRef": "lowcode_media_file"}');
INSERT INTO lowcode_material_file_data (id, creator, create_time, updater, update_time, deleted, tenant_id, file_id, file_source, data_type, version, data) VALUES (3, '1', '2025-10-01 00:00:00', '1', '2025-10-01 00:00:00', false, 1, 5, 2, 0, 1, '{"_vid": "mh3183p2q746t2Wi6ip383dQ", "widgetTree": [{"_key": "refDefine", "_vid": "mhuhv0eiREN7nUoGslWWnD7z", "label": "引用参数", "props": {}, "slots": [], "__key__": "mhuhv0elUvf2JkllR6bk0zij", "_moduleName": "codeWidgetDefines", "dataDefines": [{"_vid": "mhuhv0eiREN7nUoGslWWnD7z#pageParams", "name": "页面 Params 参数", "_type": "const", "scope": "global", "__key__": "mhuhv4qb1N0hbRtyiFKbnxNX", "refBind": {}, "jsonData": "{\\n    \\"parentId\\":0\\n}", "widgetId": "mhuhv0eiREN7nUoGslWWnD7z", "onSuccess": {"type": "simple-function", "evalFunction": "return (async () => {\\n    let initData = args[0]\\n    if (initData.id) {\\n        const resp = await $request({\\n            method: \'post\',\\n            url: \'/lowcode/deploy-api/lowcode-media-dir/select-one\',\\n            data: {\\n                \\"whereParams\\": [{\\n                    \\"name\\": \\"id\\",\\n                    \\"symbol\\": \\"EQ\\",\\n                    \\"value\\": initData.id\\n                }]\\n            }\\n        })\\n        initData = resp.data\\n    }\\n    return await $data(\'formData\', initData)\\n})()"}, "isAutoLoad": true, "propDefines": [{"_key": "#.id", "_vid": "mhuhwfd7qy3DDKqrnqSREe5b", "name": "id", "type": "number", "value": "0", "__key__": "mhuhwfd8wD5dljaxpNq2NqX8", "itemDefines": []}, {"_key": "#.parentId", "_vid": "mhuhwfd7QhWDWFAPcN1uE0O7", "name": "parentId", "type": "number", "value": "0", "__key__": "mhuhwfd8SinAgFodJr30olXX", "itemDefines": []}, {"_key": "#.name", "_vid": "mhumbl35xBnqsSsPwi4aaKIc", "name": "name", "type": "string", "__key__": "mhumbl36NFXioVIec9qlLHq6", "itemDefines": []}], "jsonDataPath": "data", "isShowLoading": true, "requestMethod": "get", "isShowErrorMsg": true, "requestUrlMode": "REF_PROJECT", "requestBodyType": "disable", "isShowSuccessMsg": false, "requestHeadersType": "disable", "requestFormDataType": "disable"}, {"_vid": "mhuhv0eiREN7nUoGslWWnD7z#query", "name": "路由 Query 参数", "_type": "const", "scope": "global", "__key__": "mhuhv4qb9LI8eC05zqW6xK38", "refBind": {}, "jsonData": "{}", "widgetId": "mhuhv0eiREN7nUoGslWWnD7z", "isAutoLoad": true, "propDefines": [], "jsonDataPath": "data", "isShowLoading": true, "requestMethod": "get", "isShowErrorMsg": true, "requestUrlMode": "REF_PROJECT", "requestBodyType": "disable", "isShowSuccessMsg": false, "requestHeadersType": "disable", "requestFormDataType": "disable"}, {"_vid": "mhuhv0eiREN7nUoGslWWnD7z#params", "name": "路由 Params 参数", "_type": "const", "scope": "global", "__key__": "mhuhv4qbLnSsBzLEDaW3DsUH", "refBind": {}, "jsonData": "{}", "widgetId": "mhuhv0eiREN7nUoGslWWnD7z", "isAutoLoad": true, "propDefines": [], "jsonDataPath": "data", "isShowLoading": true, "requestMethod": "get", "isShowErrorMsg": true, "requestUrlMode": "REF_PROJECT", "requestBodyType": "disable", "isShowSuccessMsg": false, "requestHeadersType": "disable", "requestFormDataType": "disable"}], "slotChildren": []}, {"_key": "form", "_var": "form", "_vid": "mhuhbktqgKBrepJmGNyRGzNk", "label": "表单容器", "props": {"labelWidth": "120px"}, "slots": [{"_key": "slotRender", "_vid": "mhuhbktq8EozBRX6i6F9pP5i", "label": "插槽", "props": {"span": 24}, "slots": [], "slotKey": "slot#default", "_moduleName": "innerWidgetDefines", "slotChildren": [{"_key": "treeSelect", "_vid": "mhuhbtxvWxyJLmfBNScamSWv", "label": "树形选择TreeSelect", "props": {"lazy": true, "prop": "parentId", "label": "上级目录", "putable": true, "copyable": false, "loadData": {"type": "function", "evalFunction": "return (async () => {\\n    const { level, data } = $args[0]\\n    if (level == 0) {\\n        return [{ id: 0, name: \'一级目录\' }]\\n    } else {\\n        const resp = await $request({\\n            method: \'post\',\\n            url: \'/lowcode/deploy-api/lowcode-media-dir/select-list\',\\n            data: {\\n                whereParams: [{\\n                    name: \'parentId\',\\n                    symbol: \'EQ\',\\n                    value: data.id\\n                }]\\n            }\\n        })\\n        return resp.data\\n    }\\n})()"}, "required": true, "sortable": false, "deleteable": false, "selectable": true, "loadCacheData": {"type": "function", "debounce": false, "throttle": false, "evalFunction": "return (async () => {\\n    if ($args[0]) {\\n        const resp = await $request({\\n            method: \'post\',\\n            url: \'/lowcode/deploy-api/lowcode-media-dir/select-list\',\\n            data: {\\n                whereParams: [{\\n                    name: \'id\',\\n                    symbol: \'EQ\',\\n                    value: $args[0]\\n                }]\\n            }\\n        })\\n        return resp.data\\n    }\\n})()"}}, "slots": [], "__key__": "mhuhbtxybfhp48xpBHlhVbBf", "_moduleName": "formWidgetDefines", "slotChildren": []}, {"_key": "input", "_vid": "mhuhdimf2MfLtg2CMEkLCdwQ", "label": "输入框Input", "props": {"prop": "name", "label": "目录名称", "required": true}, "slots": [], "__key__": "mhuhdimk3awP8GMDQObDeU1H", "_moduleName": "formWidgetDefines", "slotChildren": []}]}], "__key__": "mhuhbkttCRUvA3ORysNGl1cQ", "_moduleName": "containerWidgetDefines", "dataDefines": [{"_var": "formData", "_vid": "mhuhbktqgKBrepJmGNyRGzNk#formModel", "name": "表单数据", "_type": "const", "scope": "global", "__key__": "mhuhdf6fiEUiw8gDzubjW9Pz", "refBind": {}, "jsonData": "{\\n  \\"id\\": 0,\\n  \\"name\\": \\"\\",\\n  \\"parentId\\": 0\\n}", "widgetId": "mhuhbktqgKBrepJmGNyRGzNk", "isAutoLoad": true, "propDefines": [{"_key": "#.id", "_vid": "mhuhgest6R1qHMoueJ0PHyOj", "name": "id", "type": "number", "value": "0", "__key__": "mhuhgesvGaIViepKPzZH25aV", "itemDefines": []}, {"_key": "#.name", "_vid": "mhuhgest3K8xcZd9QD1zD35d", "name": "name", "type": "string", "value": "", "__key__": "mhuhgesvu5oOj2GIzdsvSHW7", "itemDefines": []}, {"_key": "#.parentId", "_vid": "mhuhgesthYZx9dywgh1kd2i6", "name": "parentId", "type": "number", "value": "0", "__key__": "mhuhgesvWM68B1Vh2jGFWl3x", "itemDefines": []}], "jsonDataPath": "data", "isShowLoading": true, "requestMethod": "get", "isShowErrorMsg": true, "requestUrlMode": "REF_PROJECT", "requestBodyType": "disable", "isShowSuccessMsg": false, "requestHeadersType": "disable", "requestFormDataType": "disable"}, {"_var": "createDir", "name": "创建目录", "_type": "submit", "scope": "global", "__key__": "mhuhnvjuwnO6MKn0Eduw0PCk", "refBind": {}, "jsonData": "{}", "widgetId": "mhuhbktqgKBrepJmGNyRGzNk", "isAutoLoad": false, "requestUrl": "/lowcode/media-dir/create", "successMsg": "创建成功", "propDefines": [], "requestBody": {"bindList": [{"bind": {"label": "表单数据 [ yRGzNk ]", "refDataId": "mhuhbktqgKBrepJmGNyRGzNk#formModel", "refDataType": "const", "refWidgetId": "mhuhbktqgKBrepJmGNyRGzNk"}, "__key__": "mhuhno4piiFzajJMlDE1ecQZ", "refPropKey": "#"}]}, "jsonDataPath": "data", "isShowLoading": true, "requestMethod": "post", "isShowErrorMsg": true, "requestUrlMode": "REF_PROJECT", "requestBodyType": "enable-bind", "isShowSuccessMsg": true, "requestHeadersType": "disable", "requestFormDataType": "disable"}, {"_var": "updateDir", "_vid": "mhuntozqpnFNjNcLXd88av3K", "name": "修改目录", "_type": "submit", "scope": "global", "__key__": "mhuhnvjuwnO6MKn0Eduw0PCk", "refBind": {}, "jsonData": "{}", "widgetId": "mhuhbktqgKBrepJmGNyRGzNk", "isAutoLoad": false, "requestUrl": "/lowcode/media-dir/update", "successMsg": "修改成功", "propDefines": [], "requestBody": {"bindList": [{"bind": {"label": "表单数据 [ form ]", "refDataId": "mhuhbktqgKBrepJmGNyRGzNk#formModel", "refDataType": "const", "refWidgetId": "mhuhbktqgKBrepJmGNyRGzNk"}, "__key__": "mhuo29iteC59sqpjEFixcPZT", "refPropKey": "#"}]}, "jsonDataPath": "data", "isShowLoading": true, "requestMethod": "put", "isShowErrorMsg": true, "requestUrlMode": "REF_PROJECT", "requestBodyType": "enable-bind", "isShowSuccessMsg": true, "requestHeadersType": "disable", "requestFormDataType": "disable"}], "slotChildren": []}], "onPageClose": {"type": "function", "evalFunction": "return $useExposeContext(\'form\').then(async (ctx) => {\\n    const data = await ctx.getData()\\n    if (data.id) {\\n        return await $data(\'updateDir\')\\n    } else {\\n        return await $data(\'createDir\')\\n    }\\n})"}, "requestUrlMode": "REF_PROJECT", "drawerPanelAutoOpen": false}');
INSERT INTO lowcode_material_file_data (id, creator, create_time, updater, update_time, deleted, tenant_id, file_id, file_source, data_type, version, data) VALUES (4, '1', '2025-10-01 00:00:00', '1', '2025-12-15 19:02:07', false, 1, 6, 2, 0, 1, '{"_vid": "mh3183p2q746t2Wi6ip383dQ", "widgetTree": [{"_key": "layout", "_vid": "mh32ijwhCqOymYkzA4e4g8nw", "label": "布局容器", "props": {"colCnt": 2, "gutter": 15, "rowCnt": 1}, "slots": [{"_key": "slotRender", "_vid": "mh32ijwii82oHUmg5ZWDBTzm", "label": "插槽", "props": {"span": 6}, "slots": [], "slotKey": "slot#0", "_moduleName": "innerWidgetDefines", "slotChildren": [{"_key": "treeView", "_vid": "mhg2shzde2srwmFS22b1uGO0", "label": "树形展示", "props": {"putable": true, "copyable": false, "loadData": {"evalFunction": "return (async () => {\\n    const resp = await $request({\\n        method: \'post\',\\n        url: \'/lowcode/deploy-api/lowcode-media-dir/select-list\'\\n    })\\n    return resp.data\\n})()"}, "sortable": false, "deleteable": false, "selectable": true, "menuButtons": [{"icon": "ep:plus", "label": "新建", "__key__": "mhgafrfubYLr7tiS2JaX2pic", "onClick": {"evalFunction": "return $dialog({\\n    title: \'新建子目录\',\\n    fileId: 5,\\n    params: {\\n        parentId: $args[0].id\\n    }\\n}).then(async () => {\\n    (await $useExposeContext()).refresh()\\n})"}, "_vIfPermis": ["lowcode:media:manage"]}, {"icon": "ep:edit", "label": "编辑", "__key__": "mhjxfzr2hrb4Mvv00Bz4fwbs", "onClick": {"evalFunction": "return $dialog({\\n    title: \'编辑目录\',\\n    fileId: 5,\\n    params: {\\n        id: $args[0].id\\n    }\\n}).then(async () => {\\n    (await $useExposeContext()).refresh()\\n})"}, "_vIfPermis": ["lowcode:media:manage"]}, {"icon": "ep:delete", "label": "删除", "__key__": "mhk9kh7273deWSRXJW4AXP1n", "onClick": {"evalFunction": "return (async () => {\\n    await $message().confirm(`是否删除${$args[0].name}`)\\n    await $submit({\\n        _var: \'deleteMediaDir\',\\n        formParams: {\\n            id: $args[0].id\\n        }\\n    });\\n    (await $useExposeContext()).refresh()\\n})()"}, "_vIfPermis": ["lowcode:media:manage"]}], "createButton": {"icon": "ep:plus", "type": "default", "plain": false, "onClick": {"evalFunction": "return $dialog({\\n    title: \'创建目录\',\\n    fileId: 5,\\n    params: {\\n        parentId: 0\\n    }\\n}).then(async () => {\\n    (await $useExposeContext()).refresh()\\n})"}, "_vIfPermis": ["lowcode:media:manage"]}, "defaultExpandAll": true, "highlightCurrent": true, "expandOnClickNode": false}, "slots": [], "__key__": "mhg2shzhnHI6ob6Zhe19jSJU", "eventsBind": {"node-click": {"type": "function", "eventType": "widget", "evalFunction": "return (async() => {\\n  await $data(\'selectedDir\', $args[0] ? $args[0] : { id: 0, dirIdPath: \'\', name: \'一级目录\' })\\n})()"}}, "_moduleName": "baseWidgetDefines", "dataDefines": [{"_var": "deleteMediaDir", "name": "删除-媒体库目录", "_type": "submit", "scope": "global", "__key__": "mhk9e0cmUgOS3NY2A5qsa7IK", "refBind": {}, "jsonData": "{}", "widgetId": "mhg2shzde2srwmFS22b1uGO0", "isAutoLoad": false, "requestUrl": "/lowcode/media-dir/delete", "successMsg": "删除成功", "propDefines": [], "jsonDataPath": "data", "isShowLoading": true, "requestMethod": "delete", "isShowErrorMsg": true, "requestUrlMode": "REF_PROJECT", "requestBodyType": "disable", "isShowSuccessMsg": true, "requestHeadersType": "disable", "requestFormDataType": "disable"}], "slotChildren": []}]}, {"_key": "slotRender", "_vid": "mh32ijwiy2QLRlhge3nK0yMX", "label": "插槽", "props": {"span": 18}, "slots": [], "slotKey": "slot#1", "_moduleName": "innerWidgetDefines", "slotChildren": [{"_key": "alert", "_vid": "mhkgabbbMliqIwTT0kmBAsSq", "label": "提示Alert", "props": {"type": "primary", "closable": false, "description": "提示文本", "_CSS_outer_margin": {"bottom": "8px"}}, "slots": [], "__key__": "mhkgabbgmfq3tMSskB4yEUmd", "propsBind": {"description": {"bindList": [{"bind": {"label": "当前选择目录 [ fileTable ]", "refDataId": "mhssc2ctlpzvDlz3njeOEtWJ", "refDataType": "def", "refWidgetId": "mhmtvxbnp7OQuztLE2NwpcVk"}, "__key__": "mhssd46haDJ8GFndexhFTox3", "refPropKey": "#.name"}], "refFunction": "(val) => `当前目录: ${val}`"}}, "_moduleName": "baseWidgetDefines", "dataDefines": [], "slotChildren": []}, {"_key": "easyTable", "_var": "fileTable", "_vid": "mhmtvxbnp7OQuztLE2NwpcVk", "label": "EasyTable", "props": {"columns": [{"prop": "id", "label": "主键", "width": "65px", "rowKey": true, "__key__": "mhst48ujHYQbUzOvyOazHgRI"}, {"prop": "dirId", "label": "目录id", "__key__": "mhst48ujNlFFlPjA4t4OH4BE"}, {"prop": "dirIdPath", "label": "目录id路径", "__key__": "mhst48uj8HsjVUfvazAEjz5M"}, {"prop": "type", "label": "文件类型", "__key__": "mhst48ujTjUvucFqznij98nl"}, {"prop": "url", "label": "文件Url", "__key__": "mhst48uja7svstiLrW4mqEhJ"}, {"prop": "__ACTION__", "label": "操作", "width": "120px", "__key__": "mhst48ujRaHD0sNko07kGOBU"}], "searchs": [{"prop": "url", "span": 8, "label": "图片url", "__key__": "mhuow6wzB0pilS4ipYiK9CNV", "inputType": "input", "symbolType": "EQ"}], "loadOnInit": false, "requestUrl": "/lowcode/deploy-api/lowcode-media-file/select-page", "rowActions": [{"icon": "ep:delete", "link": true, "size": "small", "type": "danger", "label": "删除", "__key__": "mhsuucpxtacZGfo6TYLIUqUC", "_vIfFun": {}, "onClick": {"type": "mouse-function", "evalFunction": "return (async () => {\\n    await $message().confirm(`是否要删除文件?`)\\n    await $submit({\\n        _var: \'batchDeleteFile\',\\n        requestBody: {\\n            ids: [$args[1].row.id]\\n        }\\n    });\\n    (await $useExposeContext()).tableRef().doSearch()\\n})()"}, "_vIfPermis": ["lowcode:media:manage"]}], "selectable": true, "enableSearch": true, "requestMethod": "post", "showRowAction": true, "analyzeApiDesc": "低代码-媒体库文件", "analyzeApiName": "lowcode-media-file", "maxSelectCount": null, "minSelectCount": null, "requestUrlMode": "REF_PROJECT", "showIndexColumn": false, "enablePagination": true, "defaultWhereParams": {"evalFunction": "return (async () => {\\n    const dir = await $data(\'selectedDir\') \\n    return [{\\n        name: \'dirId\',\\n        symbol: \'EQ\',\\n        value: dir.id\\n    }]\\n})()"}, "enableTableBodySlot": true, "defaultParamsFunction": {"type": "simple-function", "evalFunction": "return (async () => {\\n    const dir = await $data(\'selectedDir\')\\n    return [{ name: \'dirId\', symbol: \'EQ\', value: dir.id }]\\n})()"}, "enableSearchActionSlot": true, "enableTableBodyCardSlot": true, "enableOperationActionSlot": false}, "slots": [{"_key": "slotRender", "_vid": "mhmtx0grznpcDEtRHr0sGMMT", "label": "插槽", "props": {"span": 24, "_CSS_inner_gap": "8px", "_CSS_inner_display": "flex"}, "slots": [], "slotKey": "searchActionSlot", "_moduleName": "innerWidgetDefines", "slotChildren": [{"_key": "uploadButton", "_vid": "mhor2ff2GSFl6AWi74Pwi5bH", "label": "文件上传按钮", "props": {"limit": 100, "putable": true, "copyable": false, "fileSize": 100, "fileType": ["jpg", "png", "gif", "jpeg", "mp4"], "sortable": false, "isShowTip": false, "autoUpload": true, "deleteable": false, "selectable": true, "hiddenFileList": true}, "slots": [], "__key__": "mhor2ff7pNUJwl7fF9tNucXe", "_vIfPermis": ["lowcode:media:manage"], "eventsBind": {"upload-success": {"type": "simple-function", "eventType": "widget", "evalFunction": "return (async () => {\\n    const selectedDir = await $data(\'selectedDir\')\\n    await $submit({\\n        _var: \'batchSaveFile\',\\n        requestBody: {\\n            dirId: selectedDir.id,\\n            dirIdPath: selectedDir.idPath,\\n            urls: $args[0]\\n        }\\n    });\\n})()"}}, "_moduleName": "baseWidgetDefines", "slotChildren": []}, {"_key": "button", "_vid": "mhup2hybYO9pHPW2BiUBaDr6", "label": "按钮Button", "props": {"type": "danger", "label": "批量删除", "confirmMsg": "是否确认删除选择的文件?", "showConfirm": true}, "slots": [], "__key__": "mhup2hyeaXnRMfZpPQjQWJkc", "_vIfPermis": ["lowcode:media:manage"], "eventsBind": {"click": {"stop": false, "type": "mouse-function", "eventType": "widget", "evalFunction": "return (async () => {\\n    const ctx = await $useExposeContext(\'fileTable\')\\n    const selectedRows = ctx.tableRef().getSelectedRows()\\n    if(!selectedRows.length) {\\n        return $message().error(\'请先选择文件\')\\n    }\\n    await $submit({\\n        _var: \'batchDeleteFile\',\\n        requestBody: {\\n            ids: selectedRows.map(e => e.id)\\n        }\\n    });\\n    ctx.tableRef().setSelectedRows([])\\n})()"}}, "_moduleName": "baseWidgetDefines", "slotChildren": []}]}, {"_key": "vforDefine", "_vid": "mhsx6ztnAVcFKkgfIRgYBcOM", "label": "循环v-for", "props": {"_CSS_inner_display": "waterfall", "_CSS_inner_column-gap": "8px", "_CSS_inner_column-count": 4}, "slots": [{"_key": "easyTableCardSlot", "_vid": "mhsxd141IkXJVntoTLjrDWWk", "label": "卡片容器", "props": {"header": "", "_CSS_outer_margin": {"bottom": "8px"}}, "slots": [{"_key": "slotRender", "_vid": "mhsx6ztn5eYXDKGu7jUmbLpQ", "label": "插槽", "props": {"span": 24}, "slots": [], "slotKey": "slot#default", "_moduleName": "innerWidgetDefines", "slotChildren": [{"_key": "image", "_vid": "mhsy1rl6SBE9XqiqUYsRUNV2", "label": "图片Image", "props": {"src": "https://picsum.photos/200/300", "preview": false, "putable": true, "copyable": false, "sortable": false, "cloudType": "aliyun", "deleteable": false, "selectable": true, "defaultArgs": "x-oss-process=style/lowQuality", "previewArgs": "x-oss-process=style/watermark", "progressive": false, "thumbnailArgs": "x-oss-process=style/thumbnail"}, "slots": [], "__key__": "mhsy1rlaYefiNd1jamZxd6wO", "propsBind": {"src": {"bindList": [{"bind": {"label": "item in v-for [ gYBcOM ]", "refDataId": "mhsx6ztnAVcFKkgfIRgYBcOM#v-for-item", "refDataType": "runtime", "refWidgetId": "mhsx6ztnAVcFKkgfIRgYBcOM"}, "__key__": "mhsy1yeylPcTh5UJ08tUuCob", "refPropKey": "#.data.url"}]}}, "_moduleName": "baseWidgetDefines", "slotChildren": []}]}], "slotKey": "slot#default", "_moduleName": "advWidgetDefines", "slotChildren": []}], "slotKey": "tableBodySlot", "propsBind": {"data": {"bindList": [{"bind": {"label": "表格数据 [ fileTable ]", "refDataId": "mhmtvxbnp7OQuztLE2NwpcVk#tableData", "refDataType": "const", "refWidgetId": "mhmtvxbnp7OQuztLE2NwpcVk"}, "refPropKey": "#"}]}}, "_moduleName": "codeWidgetDefines", "slotChildren": []}, {"_key": "slotRender", "_vid": "mhuorp1q1eIGYO5mUUVO9ODc", "label": "插槽", "props": {"span": 24}, "slots": [], "slotKey": "operationActionSlot", "_moduleName": "innerWidgetDefines", "slotChildren": []}], "__key__": "mhmtwbwgmV8I1jco82JtUhwh", "propsBind": {}, "_moduleName": "advWidgetDefines", "dataDefines": [{"_var": "selectedDir", "_vid": "mhssc2ctlpzvDlz3njeOEtWJ", "name": "当前选择目录", "_type": "def", "scope": "global", "__key__": "mhsscxuoi5xnl9POJLulykaZ", "refBind": {}, "jsonData": "{\\n  \\"id\\": 0,\\n  \\"idPath\\":\\"\\",\\n  \\"name\\": \\"一级目录\\"\\n}", "widgetId": "mhmtvxbnp7OQuztLE2NwpcVk", "onSuccess": {"type": "simple-function", "evalFunction": "return (async() => {\\n  (await $useExposeContext()).tableRef().doSearch()\\n})()"}, "isAutoLoad": true, "propDefines": [{"_key": "#.id", "_vid": "mhsscm6na1M1LbbcNhXvgDCc", "name": "id", "type": "number", "value": "0", "__key__": "mhsscm6o50eoFwH7vDRCWViG", "itemDefines": []}, {"_key": "#.idPath", "_vid": "mhsscm6ni7ZYcQbJMK2u2Ax6", "name": "idPath", "type": "string", "value": "", "__key__": "mhsscm6oBsl76Unf4tz3n8lC", "itemDefines": []}, {"_key": "#.name", "_vid": "mhsscm6ndWOqE5NwwwI1vWhk", "name": "name", "type": "string", "value": "一级目录", "__key__": "mhsscm6oqh0JCasvV1ns5aPb", "itemDefines": []}], "jsonDataPath": "data", "isShowLoading": true, "requestMethod": "get", "isShowErrorMsg": true, "requestUrlMode": "REF_PROJECT", "requestBodyType": "disable", "isShowSuccessMsg": false, "requestHeadersType": "disable", "requestFormDataType": "disable"}, {"_var": "batchSaveFile", "name": "批量保存文件", "_type": "submit", "scope": "global", "__key__": "mhsrlijlmNjrSGg8T6Dpm12C", "refBind": {}, "jsonData": "{}", "widgetId": "mhmtvxbnp7OQuztLE2NwpcVk", "onSuccess": {"type": "simple-function", "evalFunction": "return (async() => {\\n  (await $useExposeContext()).tableRef().doSearch()\\n})()"}, "isAutoLoad": false, "requestUrl": "/lowcode/media-file/batch-save", "successMsg": "保存成功", "propDefines": [], "jsonDataPath": "data", "isShowLoading": true, "requestMethod": "post", "isShowErrorMsg": true, "requestUrlMode": "REF_PROJECT", "requestBodyType": "disable", "isShowSuccessMsg": true, "requestHeadersType": "disable", "requestFormDataType": "disable"}, {"_var": "batchDeleteFile", "_vid": "mhtxgro5pjlgCFeFlD0xLw4t", "name": "批量删除文件", "_type": "submit", "scope": "global", "__key__": "mhsrlijlmNjrSGg8T6Dpm12C", "refBind": {}, "jsonData": "{}", "widgetId": "mhmtvxbnp7OQuztLE2NwpcVk", "onSuccess": {"type": "simple-function", "evalFunction": "return (async() => {\\n  (await $useExposeContext()).tableRef().doSearch()\\n})()"}, "isAutoLoad": false, "requestUrl": "/lowcode/media-file/batch-delete", "successMsg": "删除成功", "propDefines": [], "jsonDataPath": "data", "isShowLoading": true, "requestMethod": "post", "isShowErrorMsg": true, "requestUrlMode": "REF_PROJECT", "requestBodyType": "disable", "isShowSuccessMsg": true, "requestHeadersType": "disable", "requestFormDataType": "disable"}, {"_vid": "mhmtvxbnp7OQuztLE2NwpcVk#tableData", "name": "表格数据", "_type": "const", "scope": "global", "__key__": "mhn0q1vdArn2THAMxFyCEwxH", "refBind": {}, "jsonData": "[]", "widgetId": "mhmtvxbnp7OQuztLE2NwpcVk", "isAutoLoad": true, "propDefines": [{"_key": "#.-", "_vid": "mhmtwbvxkhXSZiikVFPCjz4W", "name": "-", "type": "array", "__key__": "mhn0q1vf7666j0QwlFB66aeU", "comment": "数据", "itemType": "object", "itemDefines": [{"_key": "#.-.id", "_vid": "mhmtwbvx1pcr2aPXgbGMD691", "name": "id", "type": "string", "__key__": "mhn0q1vgGSW70bBPNqkiODyY", "comment": "主键", "itemDefines": []}, {"_key": "#.-.type", "_vid": "mhmtwbvx2nGSYI5mACYyHwe5", "name": "type", "type": "string", "__key__": "mhn0q1vgFytYK2cWPnQ6yhZO", "comment": "文件类型", "itemDefines": []}, {"_key": "#.-.url", "_vid": "mhmtwbvx51YBKhBMmrPRxgoT", "name": "url", "type": "string", "__key__": "mhn0q1vgFH7snNYE0qkCQMtK", "comment": "文件Url", "itemDefines": []}]}], "jsonDataPath": "data", "isShowLoading": true, "requestMethod": "get", "isShowErrorMsg": true, "requestUrlMode": "REF_PROJECT", "requestBodyType": "disable", "isShowSuccessMsg": false, "requestHeadersType": "disable", "requestFormDataType": "disable"}], "slotChildren": []}]}], "__key__": "mh32ijwrup1KkoBJzGaQp1tN", "_moduleName": "containerWidgetDefines", "slotChildren": []}], "onPageClose": {"type": "function", "evalFunction": "return (async() => {\\n  const ctx = await $useExposeContext(\'fileTable\')\\n  const rows = await ctx.tableRef().getValidSelectedRows()\\n  return rows.map(e => e.url)\\n})()"}, "requestUrlMode": "REF_PROJECT", "drawerPanelAutoOpen": false}');
INSERT INTO lowcode_material_file_data (id, creator, create_time, updater, update_time, deleted, tenant_id, file_id, file_source, data_type, version, data) VALUES (5, '1', '2025-10-01 00:00:00', '1', '2025-10-01 00:00:00', false, 1, 7, 2, 0, 1, '{"_vid": "mhu6izm8GLMq5519TUtV4Qmp", "widgetTree": [{"_key": "button", "_vid": "mhu6j4sdnYOUVRx7it76JeBA", "label": "按钮Button", "props": {"label": "选择文件"}, "slots": [], "__key__": "mhu6j4si2Jg83wr4GsqAur43", "eventsBind": {"click": {"type": "mouse-function", "eventType": "widget", "evalFunction": "return (async () => {\\n    const selected = await $dialog({\\n        title: \'选择图片\',\\n        width: 1200,\\n        fileId: 6,\\n        params: {\\n            selectable: true\\n        }\\n    })\\n    $log(`已选择${selected.length}条数据`,selected)\\n})()"}}, "_moduleName": "baseWidgetDefines", "slotChildren": []}], "requestUrlMode": "REF_PROJECT", "drawerPanelAutoOpen": false}');

INSERT INTO lowcode_deploy_api (id, creator, create_time, updater, update_time, deleted, tenant_id, api_name, api_code, source_file_id, source_file_version, api_status) VALUES (1, '1', '2025-10-01 00:00:00', '1', '2025-10-01 00:00:00', false, 1, 'lowcode-media-dir', 'API00000201', 2, 1, 1);
INSERT INTO lowcode_deploy_api (id, creator, create_time, updater, update_time, deleted, tenant_id, api_name, api_code, source_file_id, source_file_version, api_status) VALUES (2, '1', '2025-10-01 00:00:00', '1', '2025-10-01 00:00:00', false, 1, 'lowcode-media-file', 'API00000301', 3, 1, 1);

INSERT INTO system_menu (name, permission, type, sort, parent_id, path, icon, component, component_name, status, visible, keep_alive, always_show, creator, create_time, updater, update_time, deleted) VALUES ('媒体库', '', 1, 20, 0, '/media-repo', 'ep:picture-filled', '', '', 0, true, true, true, '1', '2025-10-01 00:00:00', '1', '2025-10-01 00:00:00', false);
SET @temp_id = (SELECT id FROM system_menu WHERE name = '媒体库' and path = '/media-repo' LIMIT 1);
INSERT INTO system_menu (name, permission, type, sort, parent_id, path, icon, component, component_name, status, visible, keep_alive, always_show, creator, create_time, updater, update_time, deleted) VALUES ('文件管理', 'lowcode:media:manage', 2, 0, @temp_id, 'manager', '', 'lowcode/router?fileId=6&version=1', 'MediaRepFileManger', 0, true, true, true, '1', '2025-10-01 00:00:00', '1', '2025-10-01 00:00:00', false);
SET @temp_id = (SELECT id FROM system_menu WHERE name = '文件管理' and component_name = 'MediaRepFileManger' LIMIT 1);
INSERT INTO lowcode_deploy_menu (id, creator, create_time, updater, update_time, deleted, tenant_id, menu_id, source_file_id, source_file_version, menu_status) VALUES (1, '1', '2025-10-01 00:00:00', '1', '2025-10-01 00:00:00', false, 1, @temp_id, 6, 1, 1);

INSERT INTO lowcode_media_file (id, creator, create_time, updater, update_time, deleted, tenant_id, dir_id, dir_id_path, type, url) VALUES (1, '1', '2025-10-01 00:00:00', '1', '2025-11-25 19:18:56', false, 1, 0, '1', 'jpeg', 'https://picsum.photos/200/300?random=1');
INSERT INTO lowcode_media_file (id, creator, create_time, updater, update_time, deleted, tenant_id, dir_id, dir_id_path, type, url) VALUES (2, '1', '2025-10-01 00:00:00', '1', '2025-11-25 19:18:56', false, 1, 0, '', 'jpg', 'https://picsum.photos/100/100?random=2');
INSERT INTO lowcode_media_file (id, creator, create_time, updater, update_time, deleted, tenant_id, dir_id, dir_id_path, type, url) VALUES (3, '1', '2025-10-01 00:00:00', '1', '2025-11-25 19:18:56', false, 1, 0, '', 'jpg', 'https://picsum.photos/200/200?random=3');
INSERT INTO lowcode_media_file (id, creator, create_time, updater, update_time, deleted, tenant_id, dir_id, dir_id_path, type, url) VALUES (4, '1', '2025-10-01 00:00:00', '1', '2025-11-25 19:18:56', false, 1, 0, '', 'jpeg', 'https://picsum.photos/200/300?random=4');
INSERT INTO lowcode_media_file (id, creator, create_time, updater, update_time, deleted, tenant_id, dir_id, dir_id_path, type, url) VALUES (5, '1', '2025-10-01 00:00:00', '1', '2025-11-25 19:18:56', false, 1, 0, '1', 'jpeg', 'https://picsum.photos/200/300?random=5');
INSERT INTO lowcode_media_file (id, creator, create_time, updater, update_time, deleted, tenant_id, dir_id, dir_id_path, type, url) VALUES (6, '1', '2025-10-01 00:00:00', '1', '2025-11-25 19:20:38', false, 1, 0, '', 'jpg', 'https://picsum.photos/200/200?random=6');
INSERT INTO lowcode_media_file (id, creator, create_time, updater, update_time, deleted, tenant_id, dir_id, dir_id_path, type, url) VALUES (7, '1', '2025-10-01 00:00:00', '1', '2025-11-25 19:20:38', false, 1, 0, '', 'jpg', 'https://picsum.photos/100/200?random=7');
INSERT INTO lowcode_media_file (id, creator, create_time, updater, update_time, deleted, tenant_id, dir_id, dir_id_path, type, url) VALUES (8, '1', '2025-10-01 00:00:00', '1', '2025-11-25 19:20:38', false, 1, 0, '', 'jpeg', 'https://picsum.photos/200/200?random=3');

